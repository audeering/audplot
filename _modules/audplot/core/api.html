

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>audplot.core.api &mdash; audplot Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/audeering.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/audeering.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/katex-math.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    
  

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          <a href="../../../index.html">
          
            <img src="../../../_static/images/audeering.png" class="logo" alt="audEERING"/>
          
          
            <span> audplot</span>
          
          </a>

          
            
            
              <div class="version">
                v1.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">audplot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../genindex.html">Index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">audplot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>audplot.core.api</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for audplot.core.api</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># The scipy implementation is faster,</span>
<span class="c1"># but scipy is not an official dependency of audplot</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">ndtri</span> <span class="k">as</span> <span class="n">inverse_normal_distribution</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>  <span class="c1"># pragma: nocover</span>
    <span class="kn">from</span> <span class="nn">audmath</span> <span class="kn">import</span> <span class="n">inverse_normal_distribution</span>

<span class="kn">import</span> <span class="nn">audmetric</span>


<div class="viewcode-block" id="cepstrum"><a class="viewcode-back" href="../../../api.html#audplot.cepstrum">[docs]</a><span class="k">def</span> <span class="nf">cepstrum</span><span class="p">(</span>
        <span class="n">cc_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">hop_duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">AxesImage</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Cepstrum.</span>

<span class="sd">    Args:</span>
<span class="sd">        cc_matrix: cepstral coefficients matrix with magnitude values</span>
<span class="sd">        hop_duration: hop duration in seconds</span>
<span class="sd">        channel: channel index</span>
<span class="sd">        ax: pre-existing axes for the plot.</span>
<span class="sd">            Otherwise, calls :func:`matplotlib.pyplot.gca()` internally</span>
<span class="sd">        cmap: color map</span>

<span class="sd">    Returns:</span>
<span class="sd">        Image object</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :context: reset</span>
<span class="sd">            :include-source: false</span>

<span class="sd">            from audplot import cepstrum</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import librosa</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; x, sr = librosa.load(librosa.ex(&#39;trumpet&#39;))</span>
<span class="sd">            &gt;&gt;&gt; y = librosa.feature.mfcc(x, sr)</span>
<span class="sd">            &gt;&gt;&gt; hop_dur = 512 / sr  # default hop length is 512</span>
<span class="sd">            &gt;&gt;&gt; image = cepstrum(y, hop_dur)</span>
<span class="sd">            &gt;&gt;&gt; cb = plt.colorbar(image)</span>
<span class="sd">            &gt;&gt;&gt; cb.outline.set_visible(False)</span>
<span class="sd">            &gt;&gt;&gt; plt.tight_layout()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">cc_matrix</span> <span class="o">=</span> <span class="n">cc_matrix</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="k">if</span> <span class="n">cc_matrix</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">cc_matrix</span>

    <span class="n">n_cc</span><span class="p">,</span> <span class="n">n_cepstra</span> <span class="o">=</span> <span class="n">cc_matrix</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_cepstra</span> <span class="o">*</span> <span class="n">hop_duration</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n_cc</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cepstral Coefficients&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time / s&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">cc_matrix</span><span class="p">,</span>
        <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
        <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Adjust yticks to be located at real cepstral coefficient steps</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
    <span class="n">yticks_spacing</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">n_cc</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs</span><span class="p">)))</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_cc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">yticks_spacing</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>

    <span class="c1"># Remove axis lines</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span></div>


<div class="viewcode-block" id="confusion_matrix"><a class="viewcode-back" href="../../../api.html#audplot.confusion_matrix">[docs]</a><span class="k">def</span> <span class="nf">confusion_matrix</span><span class="p">(</span>
        <span class="n">truth</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="n">prediction</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">label_aliases</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">percentage</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show_both</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Confusion matrix between ground truth and prediction.</span>

<span class="sd">    The confusion matrix is calculated by :mod:`audmetric.confusion_matrix`.</span>

<span class="sd">    Args:</span>
<span class="sd">        truth: truth values</span>
<span class="sd">        prediction: predicted values</span>
<span class="sd">        labels: labels to be included in confusion matrix</span>
<span class="sd">        label_aliases: mapping to alias names for labels</span>
<span class="sd">            to be presented in the plot</span>
<span class="sd">        percentage: if ``True`` present the confusion matrix</span>
<span class="sd">            with percentage values instead of absolute numbers</span>
<span class="sd">        show_both: if ``True`` and percentage is ``True``</span>
<span class="sd">            it shows absolute numbers in brackets</span>
<span class="sd">            below percentage values.</span>
<span class="sd">            If ``True`` and percentage is ``False``</span>
<span class="sd">            it shows the percentage in brackets</span>
<span class="sd">            below absolute numbers</span>
<span class="sd">        ax: pre-existing axes for the plot.</span>
<span class="sd">            Otherwise, calls :func:`matplotlib.pyplot.gca()` internally</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :context: reset</span>
<span class="sd">            :include-source: false</span>

<span class="sd">            from audplot import confusion_matrix</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; truth = [0, 1, 1, 1, 2, 2, 2] * 1000</span>
<span class="sd">            &gt;&gt;&gt; prediction = [0, 1, 2, 2, 0, 0, 2] * 1000</span>
<span class="sd">            &gt;&gt;&gt; confusion_matrix(truth, prediction)</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; confusion_matrix(truth, prediction, percentage=True)</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; confusion_matrix(truth, prediction, show_both=True)</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; confusion_matrix(truth, prediction, percentage=True, show_both=True)</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; confusion_matrix(truth, prediction, labels=[0, 1, 2, 3])</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; confusion_matrix(truth, prediction, label_aliases={0: &#39;A&#39;, 1: &#39;B&#39;, 2: &#39;C&#39;})</span>

<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: 501</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">audmetric</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">infer_labels</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">audmetric</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span>
        <span class="n">truth</span><span class="p">,</span>
        <span class="n">prediction</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="n">percentage</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

    <span class="c1"># Set format of first row labels in confusion matrix</span>
    <span class="k">if</span> <span class="n">percentage</span><span class="p">:</span>
        <span class="n">annot</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">100</span> <span class="o">*</span> <span class="n">x</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">annot</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">human_format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="c1"># Add a second row of annotations if requested</span>
    <span class="k">if</span> <span class="n">show_both</span><span class="p">:</span>
        <span class="n">cm2</span> <span class="o">=</span> <span class="n">audmetric</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span>
            <span class="n">truth</span><span class="p">,</span>
            <span class="n">prediction</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">normalize</span><span class="o">=</span><span class="ow">not</span> <span class="n">percentage</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cm2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cm2</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">percentage</span><span class="p">:</span>
            <span class="n">annot2</span> <span class="o">=</span> <span class="n">cm2</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">human_format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">annot2</span> <span class="o">=</span> <span class="n">cm2</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">100</span> <span class="o">*</span> <span class="n">x</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>

        <span class="c1"># Combine strings from two dataframes</span>
        <span class="c1"># by vectorizing the underlying function.</span>
        <span class="c1"># See: https://stackoverflow.com/a/42277839</span>

        <span class="k">def</span> <span class="nf">combine_string</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="se">\n</span><span class="s1">(</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1">)&#39;</span>

        <span class="n">combine_string</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">combine_string</span><span class="p">)</span>
        <span class="n">annot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">combine_string</span><span class="p">(</span><span class="n">annot</span><span class="p">,</span> <span class="n">annot2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

    <span class="c1"># Get label names to present on x- and y-axis</span>
    <span class="k">if</span> <span class="n">label_aliases</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">label_aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span>
        <span class="p">]</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">cm</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="n">annot</span><span class="p">,</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Prediction&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Truth&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="detection_error_tradeoff"><a class="viewcode-back" href="../../../api.html#audplot.detection_error_tradeoff">[docs]</a><span class="k">def</span> <span class="nf">detection_error_tradeoff</span><span class="p">(</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">error_rates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">xlim</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
        <span class="n">ylim</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Detection error tradeoff curve.</span>

<span class="sd">    A `detection error tradeoff (DET)`_ curve</span>
<span class="sd">    is a graphical plot of error rates for binary classification systems,</span>
<span class="sd">    plotting the false non-match rate (FNMR)</span>
<span class="sd">    against the false match rate (FMR).</span>

<span class="sd">    You can provide truth and prediction values</span>
<span class="sd">    as input or you can directly provide FMR and FNMR,</span>
<span class="sd">    which can be calculated using</span>
<span class="sd">    :func:`audmetric.detection_error_tradeoff`.</span>

<span class="sd">    The axes of the plot are scaled non-linearly</span>
<span class="sd">    by their `standard normal deviates`_.</span>
<span class="sd">    This means you have to scale every value</span>
<span class="sd">    by this transformation</span>
<span class="sd">    when you would like to change ticks positions</span>
<span class="sd">    or axis limits afterwards.</span>
<span class="sd">    The scaling is performed by :func:`scipy.special.ndtri`</span>
<span class="sd">    if :mod:`scipy` is installed,</span>
<span class="sd">    otherwise :func:`audmath.inverse_normal_distribution` is used,</span>
<span class="sd">    which is slower for large input arrays.</span>


<span class="sd">    .. _detection error tradeoff (DET): https://en.wikipedia.org/wiki/Detection_error_tradeoff</span>
<span class="sd">    .. _standard normal deviates: https://en.wikipedia.org/wiki/Standard_normal_deviate</span>

<span class="sd">    Args:</span>
<span class="sd">        x: truth values or false match rate (FMR)</span>
<span class="sd">        y: predicted values or false non-match rate (FNMR)</span>
<span class="sd">        error_rates: if ``False``</span>
<span class="sd">            it expects truth values as ``x``,</span>
<span class="sd">            and prediction values as ``y``.</span>
<span class="sd">            If ``True`` it expects FMR as ``x``,</span>
<span class="sd">            and FNMR as ``y``</span>
<span class="sd">        xlim: x-axis limits with :math:`x \in ]0, 1[`</span>
<span class="sd">        ylim: y-axis limits with :math:`y \in ]0, 1[`</span>
<span class="sd">        label: label to be shown in the legend.</span>
<span class="sd">            The legend will not be shown automatically</span>
<span class="sd">        ax: pre-existing axes for the plot.</span>
<span class="sd">            Otherwise, calls :func:`matplotlib.pyplot.gca()` internally</span>

<span class="sd">    Returns:</span>
<span class="sd">        function to transform input values to standard normal derivate scale</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :context: reset</span>
<span class="sd">            :include-source: false</span>

<span class="sd">            import matplotlib.pyplot as plt</span>
<span class="sd">            import numpy as np</span>
<span class="sd">            from audplot import detection_error_tradeoff</span>

<span class="sd">            np.random.seed(0)</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; truth = np.array([1] * 1000 + [0] * 1000)</span>
<span class="sd">            &gt;&gt;&gt; # Random prediction</span>
<span class="sd">            &gt;&gt;&gt; pred1 = np.random.random_sample(2000)</span>
<span class="sd">            &gt;&gt;&gt; # Better than random prediction</span>
<span class="sd">            &gt;&gt;&gt; pred2 = np.zeros(2000,)</span>
<span class="sd">            &gt;&gt;&gt; pred2[:1000] = np.random.normal(loc=0.6, scale=0.1, size=1000)</span>
<span class="sd">            &gt;&gt;&gt; pred2[1000:] = np.random.normal(loc=0.4, scale=0.1, size=1000)</span>
<span class="sd">            &gt;&gt;&gt; pred2 = np.clip(pred2, 0, 1)</span>
<span class="sd">            &gt;&gt;&gt; transform = detection_error_tradeoff(</span>
<span class="sd">            ...     truth,</span>
<span class="sd">            ...     pred1,</span>
<span class="sd">            ...     xlim=[0.01, 0.99],  # use large limits for random</span>
<span class="sd">            ...     ylim=[0.01, 0.99],</span>
<span class="sd">            ...     label=&#39;pred1&#39;,</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; # Add pred2 to plot using transformed FMR and FNMR values</span>
<span class="sd">            &gt;&gt;&gt; import audmetric</span>
<span class="sd">            &gt;&gt;&gt; fmr, fnmr, _ = audmetric.detection_error_tradeoff(truth, pred2)</span>
<span class="sd">            &gt;&gt;&gt; _ = plt.plot(transform(fmr), transform(fnmr), label=&#39;pred2&#39;)</span>
<span class="sd">            &gt;&gt;&gt; _ = plt.legend()</span>
<span class="sd">            &gt;&gt;&gt; plt.tight_layout()</span>

<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">error_rates</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">audmetric</span><span class="o">.</span><span class="n">detection_error_tradeoff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Transform values to the normal derivate scale</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">inverse_normal_distribution</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">transform</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">transform</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Detection Error Tradeoff (DET) Curve&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False Match Rate&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;False Non-Match Rate&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]</span>
    <span class="n">tick_locations</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
    <span class="n">tick_labels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.0%</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.1%</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ticks</span>
    <span class="p">]</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">tick_locations</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">tick_labels</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">tick_locations</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">tick_labels</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">transform</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">transform</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transform</span></div>


<div class="viewcode-block" id="distribution"><a class="viewcode-back" href="../../../api.html#audplot.distribution">[docs]</a><span class="k">def</span> <span class="nf">distribution</span><span class="p">(</span>
        <span class="n">truth</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="n">prediction</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Distribution of truth and predicted values.</span>

<span class="sd">    Args:</span>
<span class="sd">        truth: truth values</span>
<span class="sd">        prediction: predicted values</span>
<span class="sd">        ax: pre-existing axes for the plot.</span>
<span class="sd">            Otherwise, calls :func:`matplotlib.pyplot.gca()` internally</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :context: reset</span>
<span class="sd">            :include-source: false</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            from audplot import distribution</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; np.random.seed(0)</span>
<span class="sd">            &gt;&gt;&gt; truth = np.random.normal(loc=0.0, scale=1.0, size=1000)</span>
<span class="sd">            &gt;&gt;&gt; prediction = np.random.normal(loc=0.05, scale=0.5, size=1000)</span>
<span class="sd">            &gt;&gt;&gt; distribution(truth, prediction)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">truth</span><span class="p">,</span> <span class="n">prediction</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Truth&#39;</span><span class="p">,</span> <span class="s1">&#39;Prediction&#39;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">common_bins</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span>
        <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cut&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>  <span class="c1"># hard code like in distplot()</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1"># Force y ticks at integer locations</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></div>


<div class="viewcode-block" id="human_format"><a class="viewcode-back" href="../../../api.html#audplot.human_format">[docs]</a><span class="k">def</span> <span class="nf">human_format</span><span class="p">(</span>
        <span class="n">number</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Display large or small numbers in a human readable way.</span>

<span class="sd">    It replaces large or small numbers</span>
<span class="sd">    by no more than 3 significant digits</span>
<span class="sd">    and no more than 1 fractional digit.</span>
<span class="sd">    Instead it adds a string indicating the base,</span>
<span class="sd">    e.g. 12345 becomes 12.3k.</span>

<span class="sd">    The naming is according to:</span>

<span class="sd">    .. table::</span>
<span class="sd">        :widths: 10 10 15 12</span>

<span class="sd">        = =============== =========== =====</span>
<span class="sd">        n :math:`10^{-9}` nano</span>
<span class="sd">        u :math:`10^{-6}` micro</span>
<span class="sd">        m :math:`10^{-3}` milli</span>
<span class="sd">        k :math:`10^{3}`  thousand</span>
<span class="sd">        M :math:`10^{6}`  Million     Mega</span>
<span class="sd">        B :math:`10^{9}`  Billion     Giga</span>
<span class="sd">        T :math:`10^{12}` Trillion    Tera</span>
<span class="sd">        P :math:`10^{15}` Quadrillion Peta</span>
<span class="sd">        E :math:`10^{18}` Quintillion Exa</span>
<span class="sd">        Z :math:`10^{21}` Sextillion  Zetta</span>
<span class="sd">        Y :math:`10^{24}` Septillion  Yotta</span>
<span class="sd">        = =============== =========== =====</span>

<span class="sd">    Args:</span>
<span class="sd">        number: input number</span>

<span class="sd">    Returns:</span>
<span class="sd">        formatted number string</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if ``number`` :math:`\ge 1000^9`</span>
<span class="sd">            or ``number`` :math:`\le 1000^{-4}`</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; human_format(12345)</span>
<span class="sd">        &#39;12.3k&#39;</span>
<span class="sd">        &gt;&gt;&gt; human_format(1234567)</span>
<span class="sd">        &#39;1.2M&#39;</span>
<span class="sd">        &gt;&gt;&gt; human_format(123456789000)</span>
<span class="sd">        &#39;123B&#39;</span>
<span class="sd">        &gt;&gt;&gt; human_format(0.000123)</span>
<span class="sd">        &#39;123u&#39;</span>
<span class="sd">        &gt;&gt;&gt; human_format(0)</span>
<span class="sd">        &#39;0&#39;</span>
<span class="sd">        &gt;&gt;&gt; human_format(-1000)</span>
<span class="sd">        &#39;-1k&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;0&#39;</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
        <span class="n">number</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">number</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;n&#39;</span><span class="p">,</span>  <span class="c1"># 10^-9  nano</span>
        <span class="s1">&#39;u&#39;</span><span class="p">,</span>  <span class="c1"># 10^-6  micro</span>
        <span class="s1">&#39;m&#39;</span><span class="p">,</span>  <span class="c1"># 10^-3  milli</span>
        <span class="s1">&#39;&#39;</span><span class="p">,</span>   <span class="c1"># 0</span>
        <span class="s1">&#39;k&#39;</span><span class="p">,</span>  <span class="c1"># 10^3   thousand</span>
        <span class="s1">&#39;M&#39;</span><span class="p">,</span>  <span class="c1"># 10^6   Million      Mega</span>
        <span class="s1">&#39;B&#39;</span><span class="p">,</span>  <span class="c1"># 10^9   Billion      Giga</span>
        <span class="s1">&#39;T&#39;</span><span class="p">,</span>  <span class="c1"># 10^12  Trillion     Tera</span>
        <span class="s1">&#39;P&#39;</span><span class="p">,</span>  <span class="c1"># 10^15  Quadrillion  Peta</span>
        <span class="s1">&#39;E&#39;</span><span class="p">,</span>  <span class="c1"># 10^18  Quintillion  Exa</span>
        <span class="s1">&#39;Z&#39;</span><span class="p">,</span>  <span class="c1"># 10^21  Sextillion   Zetta</span>
        <span class="s1">&#39;Y&#39;</span><span class="p">,</span>  <span class="c1"># 10^24  Septillion   Yotta</span>
    <span class="p">]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mf">1000.0</span>
    <span class="n">magnitude</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span>
    <span class="n">number</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">number</span> <span class="o">/</span> <span class="n">k</span><span class="o">**</span><span class="n">magnitude</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">magnitude</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only magnitudes &lt; 1000 ** 9 are supported.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">magnitude</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only magnitudes &gt; 1000 ** -4 are supported.&#39;</span><span class="p">)</span>
    <span class="c1"># Make sure we show only up to 3 significant digits</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.0&#39;</span><span class="p">):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">sign</span><span class="si">}{</span><span class="n">number</span><span class="si">}{</span><span class="n">units</span><span class="p">[</span><span class="n">magnitude</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span></div>


<div class="viewcode-block" id="scatter"><a class="viewcode-back" href="../../../api.html#audplot.scatter">[docs]</a><span class="k">def</span> <span class="nf">scatter</span><span class="p">(</span>
        <span class="n">truth</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="n">prediction</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Scatter plot of truth and predicted values.</span>

<span class="sd">    Args:</span>
<span class="sd">        truth: truth values</span>
<span class="sd">        prediction: predicted values</span>
<span class="sd">        fit: if ``True``,</span>
<span class="sd">            fit a regression model relating the x and y variables</span>
<span class="sd">        order: if greater than 1,</span>
<span class="sd">            estimate a polynomial regression model (see ``fit``)</span>
<span class="sd">        ax: pre-existing axes for the plot.</span>
<span class="sd">            Otherwise, calls :func:`matplotlib.pyplot.gca()` internally</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :context: reset</span>
<span class="sd">            :include-source: false</span>

<span class="sd">            from audplot import scatter</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; truth = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
<span class="sd">            &gt;&gt;&gt; prediction = [0.1, 0.8, 2.3, 2.4, 3.9, 5, 6.2, 7.1, 7.8, 9, 9]</span>
<span class="sd">            &gt;&gt;&gt; scatter(truth, prediction, fit=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">truth</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">prediction</span><span class="p">,</span>
        <span class="n">fit_reg</span><span class="o">=</span><span class="n">fit</span><span class="p">,</span>
        <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">},</span>
        <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Truth&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="series"><a class="viewcode-back" href="../../../api.html#audplot.series">[docs]</a><span class="k">def</span> <span class="nf">series</span><span class="p">(</span>
        <span class="n">truth</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="n">prediction</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Time series plot of truth and predicted values.</span>

<span class="sd">    Args:</span>
<span class="sd">        truth: truth values</span>
<span class="sd">        prediction: predicted values</span>
<span class="sd">        ax: pre-existing axes for the plot.</span>
<span class="sd">            Otherwise, calls :func:`matplotlib.pyplot.gca()` internally</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :context: reset</span>
<span class="sd">            :include-source: false</span>

<span class="sd">            from audplot import series</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; truth = [-1, 0, 1, 0, -1, 0, 1]</span>
<span class="sd">            &gt;&gt;&gt; prediction = [0, 1, 0, -1, 0, 1, 0]</span>
<span class="sd">            &gt;&gt;&gt; series(truth, prediction)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">truth</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">prediction</span><span class="p">)])</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">truth</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">prediction</span><span class="p">)])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">truth</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Truth&#39;</span><span class="p">,</span> <span class="s1">&#39;Prediction&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="signal"><a class="viewcode-back" href="../../../api.html#audplot.signal">[docs]</a><span class="k">def</span> <span class="nf">signal</span><span class="p">(</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">sampling_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Time signal.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: array with signal values</span>
<span class="sd">        sampling_rate: sampling rate in Hz</span>
<span class="sd">        channel: channel index</span>
<span class="sd">        ax: pre-existing axes for the plot.</span>
<span class="sd">            Otherwise, calls :func:`matplotlib.pyplot.gca()` internally</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :context: reset</span>
<span class="sd">            :include-source: false</span>

<span class="sd">            from audplot import signal</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import librosa</span>
<span class="sd">            &gt;&gt;&gt; x, sr = librosa.load(librosa.ex(&#39;trumpet&#39;))</span>
<span class="sd">            &gt;&gt;&gt; signal(x, sr)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">x</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">sampling_rate</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time / s&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="spectrum"><a class="viewcode-back" href="../../../api.html#audplot.spectrum">[docs]</a><span class="k">def</span> <span class="nf">spectrum</span><span class="p">(</span>
        <span class="n">magnitude</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">hop_duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">centers</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">AxesImage</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot spectrum.</span>

<span class="sd">    Args:</span>
<span class="sd">        magnitude: matrix with magnitude values</span>
<span class="sd">        hop_duration: hop duration in seconds</span>
<span class="sd">        centers: array with center frequencies</span>
<span class="sd">        channel: channel index</span>
<span class="sd">        cmap: color map</span>
<span class="sd">        ax: pre-existing axes for the plot.</span>
<span class="sd">            Otherwise, calls :func:`matplotlib.pyplot.gca()` internally</span>

<span class="sd">    Returns:</span>
<span class="sd">        Image object</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :context: reset</span>
<span class="sd">            :include-source: false</span>

<span class="sd">            from audplot import spectrum</span>
<span class="sd">            import numpy as np</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import librosa</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; x, sr = librosa.load(librosa.ex(&#39;trumpet&#39;))</span>
<span class="sd">            &gt;&gt;&gt; y = librosa.feature.melspectrogram(x, sr, n_mels=40, fmax=4000)</span>
<span class="sd">            &gt;&gt;&gt; y_db = librosa.power_to_db(y, ref=np.max)</span>
<span class="sd">            &gt;&gt;&gt; hop_dur = 512 / sr  # default hop length is 512</span>
<span class="sd">            &gt;&gt;&gt; centers = librosa.mel_frequencies(n_mels=40, fmax=4000)</span>
<span class="sd">            &gt;&gt;&gt; image = spectrum(y_db, hop_dur, centers)</span>
<span class="sd">            &gt;&gt;&gt; cb = plt.colorbar(image, format=&#39;%+2.0f dB&#39;)</span>
<span class="sd">            &gt;&gt;&gt; cb.outline.set_visible(False)</span>
<span class="sd">            &gt;&gt;&gt; plt.tight_layout()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="k">if</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">magnitude</span>

    <span class="n">frequencies</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">times</span> <span class="o">*</span> <span class="n">hop_duration</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">frequencies</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency / Hz&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time / s&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">magnitude</span><span class="p">,</span>
        <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
        <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add center frequencies as yticks labels</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">val</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">centers</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="c1"># Adjust yticks to be located at real center frequencies</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
    <span class="n">yticks_spacing</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">frequencies</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs</span><span class="p">)))</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">frequencies</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">yticks_spacing</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>

    <span class="c1"># Remove axis lines</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span></div>


<div class="viewcode-block" id="waveform"><a class="viewcode-back" href="../../../api.html#audplot.waveform">[docs]</a><span class="k">def</span> <span class="nf">waveform</span><span class="p">(</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;#E13B41&#39;</span><span class="p">,</span>
        <span class="n">background</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;#FFFFFF00&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
        <span class="n">ylim</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot waveform of a mono signal.</span>

<span class="sd">    Shows only the outline of a time signal</span>
<span class="sd">    without showing any axis or values.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: array with signal values</span>
<span class="sd">        text: optional text to be displayed</span>
<span class="sd">            on the left side of the waveform</span>
<span class="sd">        color: color of wave form and text</span>
<span class="sd">        background: color of background</span>
<span class="sd">        linewidth: line width of signal</span>
<span class="sd">        ylim: limits of y-axis</span>
<span class="sd">        ax: pre-existing axes for the plot.</span>
<span class="sd">            Otherwise, calls :func:`matplotlib.pyplot.gca()` internally</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: if signal has more than one channel</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :context: reset</span>
<span class="sd">            :include-source: false</span>

<span class="sd">            from audplot import waveform</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import librosa</span>
<span class="sd">            &gt;&gt;&gt; x, _ = librosa.load(librosa.ex(&#39;trumpet&#39;))</span>
<span class="sd">            &gt;&gt;&gt; waveform(x, text=&#39;Trumpet&#39;)</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import librosa</span>
<span class="sd">            &gt;&gt;&gt; x, _ = librosa.load(librosa.ex(&#39;trumpet&#39;))</span>
<span class="sd">            &gt;&gt;&gt; waveform(x, background=&#39;#363636&#39;, color=&#39;#f6f6f6&#39;)</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :context: close-figs</span>

<span class="sd">            &gt;&gt;&gt; import librosa</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; x, _ = librosa.load(librosa.ex(&#39;trumpet&#39;, hq=True), mono=False)</span>
<span class="sd">            &gt;&gt;&gt; _, axs = plt.subplots(2, figsize=(8, 3))</span>
<span class="sd">            &gt;&gt;&gt; plt.subplots_adjust(hspace=0)</span>
<span class="sd">            &gt;&gt;&gt; waveform(</span>
<span class="sd">            ...     x[0, :],</span>
<span class="sd">            ...     text=&#39;Left &#39;,  # empty space for same size as &#39;Right&#39;</span>
<span class="sd">            ...     linewidth=0.5,</span>
<span class="sd">            ...     background=&#39;#389DCD&#39;,</span>
<span class="sd">            ...     color=&#39;#1B5975&#39;,</span>
<span class="sd">            ...     ax=axs[0],</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; waveform(</span>
<span class="sd">            ...     x[1, :],</span>
<span class="sd">            ...     text=&#39;Right&#39;,</span>
<span class="sd">            ...     linewidth=0.5,</span>
<span class="sd">            ...     background=&#39;#CA5144&#39;,</span>
<span class="sd">            ...     color=&#39;#742A23&#39;,</span>
<span class="sd">            ...     ax=axs[1],</span>
<span class="sd">            ... )</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Setting the figsize has to be done first</span>
    <span class="c1"># before requesting axis or figure.</span>
    <span class="c1"># If axis/figure exist already it will have no effect</span>

    <span class="c1"># Set default figsize if no existing figure is used</span>
    <span class="n">default_figsize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">channels</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">channels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Only mono signals are supported.&#39;</span><span class="p">)</span>
    <span class="c1"># Set colors</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">background</span><span class="p">)</span>
    <span class="c1"># Plot waveform</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>

    <span class="c1"># Remove all axis</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[])</span>

    <span class="c1"># Add text before waveform</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">space_around_text</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">samples</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="o">-</span><span class="n">space_around_text</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Get left position of text and adjust xlim accordingly</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_renderer</span><span class="p">())</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">space_around_text</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">)</span>

    <span class="c1"># Restore default figure size</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_figsize</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div>
    <p>
        
        
        
          Built with <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a> on 2021/12/10 using the <a href="https://github.com/audeering/sphinx-audeering-theme/">audEERING theme</a>
        
    </p>
  </div>

  <div role="contentinfo">
    <p>
        
      &copy; 2020-2021 audEERING GmbH
    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  



  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js"></script>
        <script src="../../../_static/katex_autorenderer.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>